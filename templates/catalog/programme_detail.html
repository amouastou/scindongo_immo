{% extends 'base.html' %}
{% block content %}
<div class="row mb-4">
  <div class="col-md-7">
    <h1>{{ programme.nom }}</h1>
    <p class="text-muted">{{ programme.adresse }}</p>
    <p>{{ programme.description }}</p>
    <p><strong>Notaire :</strong> {{ programme.notaire }}</p>
    <p><strong>Contact :</strong> {{ programme.contact }}</p>
  </div>
  <div class="col-md-5">
    {% if programme.image_principale %}
      <img src="{{ programme.image_principale.url }}" class="img-fluid rounded shadow-sm mb-3" alt="{{ programme.nom }}">
    {% endif %}
    <div id="programme-map" style="height: 250px;" class="rounded border"></div>
  </div>
</div>

<h3 class="mb-3">Unités du programme</h3>
<div class="row g-3">
  {% for unite in programme.unites.all %}
  <div class="col-md-4">
    <div class="card h-100 shadow-sm">
      {% if unite.image %}
        <img src="{{ unite.image.url }}" class="card-img-top" alt="{{ unite.reference_lot }}">
      {% endif %}
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ unite.reference_lot }}</h5>
        <p class="card-text">Modèle : {{ unite.modele_bien.nom_marketing }}</p>
        <p class="card-text fw-bold">Prix TTC : {{ unite.prix_ttc }} FCFA</p>
        <p class="card-text"><span class="badge bg-secondary">{{ unite.get_statut_disponibilite_display }}</span></p>
        <a href="{% url 'unite_detail' unite.id %}" class="btn btn-outline-primary mt-auto">Voir le lot</a>
      </div>
    </div>
  </div>
  {% empty %}
  <p>Aucune unité définie pour ce programme.</p>
  {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
  {% if programme.gps_lat and programme.gps_lng %}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('programme-map').setView([{{ programme.gps_lat }}, {{ programme.gps_lng }}], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);
    L.marker([{{ programme.gps_lat }}, {{ programme.gps_lng }}]).addTo(map)
      .bindPopup('{{ programme.nom|escapejs }}')
      .openPopup();
  </script>
  {% endif %}
{% endblock %}
