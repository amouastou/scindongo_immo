{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-4">ğŸ“‹ DÃ©tails de la Demande de Financement</h2>

  <div class="row">
    <!-- Informations du client -->
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">ğŸ‘¤ Informations du Client</h5>
        </div>
        <div class="card-body">
          <p><strong>Nom :</strong> {{ client.prenom }} {{ client.nom }}</p>
          <p><strong>Email :</strong> {{ client.email }}</p>
          <p><strong>TÃ©lÃ©phone :</strong> {{ client.telephone }}</p>
          <p><strong>Statut KYC :</strong> {{ client.kyc_statut|default:"Non renseignÃ©" }}</p>
        </div>
      </div>
    </div>

    <!-- Informations de la rÃ©servation -->
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">ğŸ˜ï¸ UnitÃ© RÃ©servÃ©e</h5>
        </div>
        <div class="card-body">
          <p><strong>RÃ©fÃ©rence :</strong> {{ unite.reference }}</p>
          <p><strong>Programme :</strong> {{ unite.programme.nom }}</p>
          <p><strong>Type :</strong> {{ unite.type_bien.libelle }}</p>
          <p><strong>Prix TTC :</strong> {{ unite.prix_ttc|floatformat:0 }} FCFA</p>
          <p><strong>Acompte versÃ© :</strong> {{ reservation.acompte|floatformat:0 }} FCFA</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- DÃ©tails du financement -->
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0">ğŸ’° Demande de Financement</h5>
        </div>
        <div class="card-body">
          <p><strong>Banque :</strong> {{ banque.nom }}</p>
          <p><strong>Code banque :</strong> {{ banque.code_banque }}</p>
          <p><strong>Contact :</strong> {{ banque.contact }}</p>
          <hr>
          <p><strong>Montant demandÃ© :</strong> <span class="display-6 text-warning fw-bold">{{ financement.montant|floatformat:0 }} FCFA</span></p>
          <p><strong>Type :</strong> {{ financement.type }}</p>
          <p><strong>Date de demande :</strong> {{ financement.created_at|date:"d/m/Y H:i" }}</p>
        </div>
      </div>
    </div>

    <!-- Statut actuel et actions -->
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0">ğŸ“Š Statut de la Demande</h5>
        </div>
        <div class="card-body">
          <p class="mb-3">
            <strong>Statut actuel :</strong><br>
            {% if financement.statut == 'soumis' %}
              <span class="badge bg-info p-2">ğŸ“® Soumis</span>
            {% elif financement.statut == 'en_etude' %}
              <span class="badge bg-warning text-dark p-2">ğŸ“š En Ã©tude</span>
            {% elif financement.statut == 'accepte' %}
              <span class="badge bg-success p-2">âœ… AcceptÃ©</span>
            {% elif financement.statut == 'refuse' %}
              <span class="badge bg-danger p-2">âŒ RefusÃ©</span>
            {% elif financement.statut == 'clos' %}
              <span class="badge bg-secondary p-2">ğŸ Clos</span>
            {% endif %}
          </p>

          <!-- Formulaire de changement de statut -->
          <form method="post">
            {% csrf_token %}
            <div class="mb-3">
              <label for="statut" class="form-label"><strong>Changer le statut :</strong></label>
              <select name="statut" id="statut" class="form-select" required>
                <option value="">-- SÃ©lectionnez un statut --</option>
                <option value="soumis" {% if financement.statut == 'soumis' %}selected{% endif %}>ğŸ“® Soumis</option>
                <option value="en_etude" {% if financement.statut == 'en_etude' %}selected{% endif %}>ğŸ“š En Ã©tude</option>
                <option value="accepte" {% if financement.statut == 'accepte' %}selected{% endif %}>âœ… AcceptÃ©</option>
                <option value="refuse" {% if financement.statut == 'refuse' %}selected{% endif %}>âŒ RefusÃ©</option>
                <option value="clos" {% if financement.statut == 'clos' %}selected{% endif %}>ğŸ Clos</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">ğŸ’¾ Mettre Ã  jour le statut</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages de statut -->
  {% if financement.statut == 'soumis' %}
    <div class="alert alert-info">
      <strong>ğŸ“® Demande soumise</strong><br>
      Cette demande vient d'Ãªtre soumise par le client. Passez-la en "En Ã©tude" pour indiquer que vous l'examinez.
    </div>
  {% elif financement.statut == 'en_etude' %}
    <div class="alert alert-warning">
      <strong>ğŸ“š Demande en cours d'Ã©tude</strong><br>
      Cette demande est actuellement examinÃ©e. Passez-la Ã  "AcceptÃ©" ou "RefusÃ©" selon la dÃ©cision de la banque.
    </div>
  {% elif financement.statut == 'accepte' %}
    <div class="alert alert-success">
      <strong>âœ… Demande acceptÃ©e</strong><br>
      Le financement a Ã©tÃ© acceptÃ© par la banque. Le client a Ã©tÃ© notifiÃ©. Passez le dossier Ã  "Clos" une fois le financement complÃ©tÃ©.
    </div>
  {% elif financement.statut == 'refuse' %}
    <div class="alert alert-danger">
      <strong>âŒ Demande refusÃ©e</strong><br>
      La demande de financement a Ã©tÃ© refusÃ©e par la banque. Le client a Ã©tÃ© notifiÃ©. Vous pouvez clore le dossier.
    </div>
  {% elif financement.statut == 'clos' %}
    <div class="alert alert-secondary">
      <strong>ğŸ Dossier clÃ´turÃ©</strong><br>
      Ce dossier de financement est terminÃ© et archivÃ©.
    </div>
  {% endif %}

  <div class="mt-4">
    <a href="{% url 'commercial_financing_list' %}" class="btn btn-secondary">â† Retour Ã  la liste</a>
  </div>
</div>
{% endblock %}
